# ğŸ›°ï¸ Orbit CLI â€” The Launchpad

> The Orbit Command Line Interface is your gateway to the Orbit ecosystem. It handles authentication, local build execution, hardware telemetry streaming, multi-platform deployment, and tunnel hosting â€” all from your terminal.

[![npm](https://img.shields.io/npm/v/@srizdebnath/orbit?style=flat-square&logo=npm&color=blue)](https://www.npmjs.com/package/@srizdebnath/orbit)

---

## ğŸ“¦ Installation

Install globally via npm:

```bash
npm install -g @srizdebnath/orbit
```

**Requirements:**
- Node.js â‰¥ 18
- npm â‰¥ 9
- *(For Laptop Hosting)* [Cloudflared](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/) installed and in your PATH
- *(For Vercel/Netlify)* Respective CLIs installed and authenticated (`npx vercel login` / `npx netlify login`)

---

## ğŸ› ï¸ Commands

### `orbit login`

Securely links your terminal to your Orbit Dashboard account using a handshake flow.

**How it works:**
1. Generates a unique 6-digit alphanumeric session code.
2. Inserts the code into the `cli_auth` Supabase table.
3. Opens your browser to the dashboard's `/auth/cli?code=XXXXXX` page.
4. You authenticate with GitHub in the browser, which approves the code.
5. The CLI polls the database every 2 seconds until approved.
6. On success, a session token is saved to `~/.orbit_session.json`.

```bash
$ orbit login

ğŸ”‘ Login Code: A3BX9K
# Browser opens â†’ Authenticate with GitHub â†’ Done!
âœ… Authenticated!
```

---

### `orbit deploy`

The core command to build, deploy, and stream telemetry for your project.

**Supported platforms:**

| Platform | What Happens |
|---|---|
| **Vercel** | Runs `npm run build` locally, then pushes to Vercel production via `npx vercel --confirm --prod`. |
| **Netlify** | Runs `npm run build` locally, then deploys via `npx netlify deploy --prod --dir=.next`. |
| **Laptop Hosting (Tunnel)** | Skips local build. Exposes your running dev server to the internet via a Cloudflare Tunnel. |
| **Self-Host (VPS)** | Connects to your VPS via SSH, uploads a Dockerfile, builds a container, and configures Caddy as a reverse proxy. |

**During deployment:**
- **Build logs** are streamed in real-time to the Supabase `deployments` table, viewable in the dashboard's Terminal View.
- **CPU & RAM metrics** are sampled every 3 seconds via `systeminformation` and streamed to the `metrics` table.

```bash
$ orbit deploy

? Select Target Platform: Vercel
? Project Name: my-app

ğŸ› ï¸  Running build sequence...
ğŸš€ Pushing to Vercel...
âœ… Orbit Mission Complete!
```

---

### `orbit deploy` â†’ Laptop Hosting (Tunnel Mode)

This sub-flow lets you host your app directly from your machine by exposing a local port via Cloudflare Tunnel.

```bash
$ orbit deploy

? Select Target Platform: Laptop Hosting (Tunnel)
? Project Name: my-app
? Which port is your app running on? 3000

 ORBIT TUNNEL  Bridging port 3000...

âš ï¸  IMPORTANT: Make sure your project is running on localhost:3000
(Run 'npm run dev' or 'npm start' in another terminal if you haven't yet)

ğŸŒ YOUR PROJECT IS LIVE AT: https://abc123.trycloudflare.com
```

> **Note:** Tunnel mode keeps the process alive indefinitely. Press `Ctrl+C` to stop.

---

## âš™ï¸ Architecture

```
packages/cli/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts        # Main entry point â€” Commander program, login & deploy logic
â”‚   â””â”€â”€ engine.ts       # VPS deployment engine (SSH â†’ Docker â†’ Caddy)
â”œâ”€â”€ dist/               # Compiled JS output (generated by `npm run build`)
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env                # (gitignored) Local overrides for dev
```

### How It Works (Step-by-Step)

1. **Detection** â€” Orbit checks your current directory for a `package.json` to identify the project.
2. **Authentication** â€” Reads the session token from `~/.orbit_session.json` (created by `orbit login`).
3. **Project Sync** â€” Upserts a record in the `projects` table keyed by `(name, user_id)`.
4. **Deployment Record** â€” Creates a new entry in the `deployments` table with status `building`.
5. **Telemetry** â€” Starts a 3-second interval sampling CPU load and active RAM via `systeminformation`, inserting into the `metrics` table.
6. **Build** â€” Runs `npm run build` locally (skipped for tunnel mode), streaming `stdout` to the `deployments.logs` column.
7. **Platform Push** â€” Executes the platform-specific deployment command (Vercel CLI, Netlify CLI, Cloudflare Tunnel, or SSH).
8. **Finalize** â€” Updates the project status to `success` and saves the live URL to `projects.domain`.

### VPS Engine (`engine.ts`)

For self-hosted deployments, the engine:
1. Connects via SSH using a private key.
2. Creates a project directory at `~/orbit/<project-name>/`.
3. Writes a `Dockerfile` (Node.js 18 slim, `npm install` + `npm run build`, exposes port 3000).
4. Appends a `Caddyfile` entry for automatic HTTPS reverse proxy.
5. Reloads the Caddy service.

---

## ğŸ”§ Development

### Build from Source

```bash
cd packages/cli
npm install
npm run build       # Compiles TypeScript â†’ dist/
npm link            # Makes `orbit` available globally
```

### Watch Mode

```bash
npm run dev         # Runs tsc in watch mode
```

### Configuration Constants

The following constants are defined at the top of `src/index.ts` and should be updated if you're self-hosting:

| Constant | Default | Description |
|---|---|---|
| `ORBIT_URL` | `https://orbit-gamma-seven.vercel.app/` | URL of the Orbit Dashboard |
| `SUPABASE_URL` | *(hardcoded)* | Supabase project URL |
| `SUPABASE_ANON_KEY` | *(hardcoded)* | Supabase anonymous key |
| `CONFIG_PATH` | `~/.orbit_session.json` | Path to the local session file |

---

## âš ï¸ Known Limitations

- **VPS deployment** does not currently upload your project files â€” only generates a Dockerfile scaffold. File transfer (e.g., via `tar` + `scp`) is not yet wired up.
- **Netlify deploy** defaults to `--dir=.next` which only works for Next.js projects. Other frameworks need different output directories.
- **Tunnel mode** never exits on its own â€” requires manual `Ctrl+C`.
- **No `orbit logout`** command exists yet.
- **No `orbit status`** command to check deployment state from the CLI.

---

## ğŸ“œ License

ISC

---

## ğŸ‘¨â€ğŸ’» Author

**Srizdebnath** â€” [GitHub](https://github.com/Srizdebnath) Â· [LinkedIn](https://linkedin.com/in/srizdebnath) Â· [Portfolio](https://sriz.vercel.app)